{"version":3,"sources":["PathEffects.ts"],"names":["Path1DEffectStyle","JsiDeclarationNode","DeclarationType","NodeType","enumKey","processPath","PathEffectDeclaration","constructor","ctx","type","props","PathEffect","addChild","child","Error","insertChildBefore","before","compose","pe","children","_children","length","Skia","MakeCompose","reduce","acc","materialize","getOptionalChildInstance","index","getMandatoryChildInstance","isPathEffect","DiscretePathEffectNode","DiscretePathEffect","deviation","seed","MakeDiscrete","Path2DPathEffectNode","Path2DPathEffect","matrix","path","MakePath2D","DashPathEffectNode","DashPathEffect","intervals","phase","MakeDash","CornerPathEffectNode","CornerPathEffect","r","MakeCorner","SumPathEffectNode","SumPathEffect","MakeSum","Line2DPathEffectNode","Line2DPathEffect","width","MakeLine2D","Path1DPathEffectNode","Path1DPathEffect","advance","style","MakePath1D"],"mappings":"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","sourcesContent":["import { Path1DEffectStyle } from \"../../../skia/types\";\nimport type { SkPathEffect } from \"../../../skia/types\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type {\n  CornerPathEffectProps,\n  DashPathEffectProps,\n  DiscretePathEffectProps,\n  Line2DPathEffectProps,\n  Node,\n  Path1DPathEffectProps,\n  Path2DPathEffectProps,\n} from \"../../types\";\nimport { DeclarationType, NodeType } from \"../../types\";\nimport { enumKey } from \"../datatypes/Enum\";\nimport { processPath } from \"../datatypes\";\n\nabstract class PathEffectDeclaration<\n  P,\n  Nullable extends null | never = never\n> extends JsiDeclarationNode<P, SkPathEffect, Nullable> {\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, DeclarationType.PathEffect, type, props);\n  }\n\n  addChild(child: Node<unknown>) {\n    if (!(child instanceof PathEffectDeclaration)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof PathEffectDeclaration)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n  }\n\n  compose(pe: SkPathEffect) {\n    const children = this._children as PathEffectDeclaration<unknown>[];\n    if (this._children.length === 0) {\n      return pe;\n    } else {\n      return this.Skia.PathEffect.MakeCompose(\n        pe,\n        children.reduce<SkPathEffect | null>((acc, child) => {\n          if (acc === null) {\n            return child.materialize();\n          }\n          return this.Skia.PathEffect.MakeCompose(acc, child.materialize());\n        }, null) as SkPathEffect\n      );\n    }\n  }\n  getOptionalChildInstance(index: number) {\n    const child = this._children[index];\n    if (!child) {\n      return null;\n    }\n    return this.getMandatoryChildInstance(index);\n  }\n\n  getMandatoryChildInstance(index: number) {\n    const child = this._children[index];\n    if (child instanceof JsiDeclarationNode) {\n      if (child.isPathEffect()) {\n        return child.materialize();\n      } else {\n        throw new Error(`Found invalid child ${child.type} in ${this.type}`);\n      }\n    } else {\n      throw new Error(`Found invalid child ${child.type} in ${this.type}`);\n    }\n  }\n}\n\nexport class DiscretePathEffectNode extends PathEffectDeclaration<DiscretePathEffectProps> {\n  constructor(ctx: NodeContext, props: DiscretePathEffectProps) {\n    super(ctx, NodeType.DiscretePathEffect, props);\n  }\n\n  materialize() {\n    const { length, deviation, seed } = this.props;\n    const pe = this.Skia.PathEffect.MakeDiscrete(length, deviation, seed);\n    return this.compose(pe);\n  }\n}\n\nexport class Path2DPathEffectNode extends PathEffectDeclaration<\n  Path2DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Path2DPathEffectProps) {\n    super(ctx, NodeType.Path2DPathEffect, props);\n  }\n\n  materialize() {\n    const { matrix } = this.props;\n    const path = processPath(this.Skia, this.props.path);\n    const pe = this.Skia.PathEffect.MakePath2D(matrix, path);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class DashPathEffectNode extends PathEffectDeclaration<DashPathEffectProps> {\n  constructor(ctx: NodeContext, props: DashPathEffectProps) {\n    super(ctx, NodeType.DashPathEffect, props);\n  }\n\n  materialize() {\n    const { intervals, phase } = this.props;\n    const pe = this.Skia.PathEffect.MakeDash(intervals, phase);\n    return this.compose(pe);\n  }\n}\n\nexport class CornerPathEffectNode extends PathEffectDeclaration<\n  CornerPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: CornerPathEffectProps) {\n    super(ctx, NodeType.CornerPathEffect, props);\n  }\n\n  materialize() {\n    const { r } = this.props;\n    const pe = this.Skia.PathEffect.MakeCorner(r);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class SumPathEffectNode extends PathEffectDeclaration<null> {\n  constructor(ctx: NodeContext) {\n    super(ctx, NodeType.SumPathEffect, null);\n  }\n\n  materialize() {\n    return this.Skia.PathEffect.MakeSum(\n      this.getMandatoryChildInstance(0),\n      this.getMandatoryChildInstance(1)\n    );\n  }\n}\n\nexport class Line2DPathEffectNode extends PathEffectDeclaration<\n  Line2DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Line2DPathEffectProps) {\n    super(ctx, NodeType.Line2DPathEffect, props);\n  }\n\n  materialize() {\n    const { width, matrix } = this.props;\n    const pe = this.Skia.PathEffect.MakeLine2D(width, matrix);\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n\nexport class Path1DPathEffectNode extends PathEffectDeclaration<\n  Path1DPathEffectProps,\n  null\n> {\n  constructor(ctx: NodeContext, props: Path1DPathEffectProps) {\n    super(ctx, NodeType.Path1DPathEffect, props);\n  }\n\n  materialize() {\n    const { advance, phase, style } = this.props;\n    const path = processPath(this.Skia, this.props.path);\n    const pe = this.Skia.PathEffect.MakePath1D(\n      path,\n      advance,\n      phase,\n      Path1DEffectStyle[enumKey(style)]\n    );\n    if (pe === null) {\n      return null;\n    }\n    return this.compose(pe);\n  }\n}\n"]}