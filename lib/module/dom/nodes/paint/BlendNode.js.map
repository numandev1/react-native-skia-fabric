{"version":3,"sources":["BlendNode.ts"],"names":["BlendMode","DeclarationType","NodeType","JsiDeclarationNode","enumKey","ImageFilterDeclaration","ShaderDeclaration","BlendNode","constructor","ctx","props","ImageFilter","Blend","checkChild","child","_children","length","declarationType","Shader","addChild","Error","type","insertChildBefore","before","materialize","Skia","blend","mode","reverse","reduce","inner","outer","MakeBlend"],"mappings":"AAEA,SAASA,SAAT,QAA0B,qBAA1B;AACA,SAASC,eAAT,EAA0BC,QAA1B,QAA0C,sBAA1C;AAEA,SAASC,kBAAT,QAAmC,SAAnC;AAEA,SAASC,OAAT,QAAwB,cAAxB;AAEA,SAASC,sBAAT,QAAuC,gBAAvC;AACA,SAASC,iBAAT,QAAkC,WAAlC;AAEA,OAAO,MAAMC,SAAN,SAAwBJ,kBAAxB,CAGL;AACAK,EAAAA,WAAW,CAACC,GAAD,EAAmBC,KAAnB,EAAsC;AAC/C,UAAMD,GAAN,EAAWR,eAAe,CAACU,WAA3B,EAAwCT,QAAQ,CAACU,KAAjD,EAAwDF,KAAxD;AACD;;AAEOG,EAAAA,UAAU,CAChBC,KADgB,EAEhB;AACA,QAAI,KAAKC,SAAL,CAAeC,MAAf,GAAwB,CAA5B,EAA+B;AAC7B,UAAIF,KAAK,CAACG,eAAN,KAA0BhB,eAAe,CAACU,WAA9C,EAA2D;AACzD,aAAKM,eAAL,GAAuBhB,eAAe,CAACU,WAAvC;AACD,OAFD,MAEO;AACL,aAAKM,eAAL,GAAuBhB,eAAe,CAACiB,MAAvC;AACD;AACF;AACF;;AAEDC,EAAAA,QAAQ,CAACL,KAAD,EAAuB;AAC7B,QACE,EAAEA,KAAK,YAAYX,kBAAnB,KACCW,KAAK,CAACG,eAAN,KAA0BhB,eAAe,CAACiB,MAA1C,IACCJ,KAAK,CAACG,eAAN,KAA0BhB,eAAe,CAACU,WAH9C,EAIE;AACA,YAAM,IAAIS,KAAJ,CAAW,4BAA2BN,KAAK,CAACO,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;AACD;;AACD,SAAKR,UAAL,CAAgBC,KAAhB;AACA,UAAMK,QAAN,CAAeL,KAAf;AACD;;AAEDQ,EAAAA,iBAAiB,CAACR,KAAD,EAAuBS,MAAvB,EAAoD;AACnE,QACE,EAAET,KAAK,YAAYT,sBAAnB,KACA,EAAES,KAAK,YAAYR,iBAAnB,CAFF,EAGE;AACA,YAAM,IAAIc,KAAJ,CAAW,4BAA2BN,KAAK,CAACO,IAAK,OAAM,KAAKA,IAAK,EAAjE,CAAN;AACD;;AACD,SAAKR,UAAL,CAAgBC,KAAhB;AACA,UAAMQ,iBAAN,CAAwBR,KAAxB,EAA+BS,MAA/B;AACD;;AAEDC,EAAAA,WAAW,GAAG;AACZ,UAAM;AAAEC,MAAAA;AAAF,QAAW,IAAjB;AACA,UAAMC,KAAK,GAAG1B,SAAS,CAACI,OAAO,CAAC,KAAKM,KAAL,CAAWiB,IAAZ,CAAR,CAAvB;;AACA,QAAI,KAAKV,eAAL,KAAyBhB,eAAe,CAACU,WAA7C,EAA0D;AACxD,aAAQ,KAAKI,SAAN,CACJa,OADI,GAEJC,MAFI,CAEyB,CAACC,KAAD,EAAQC,KAAR,KAAkB;AAC9C,YAAID,KAAK,KAAK,IAAd,EAAoB;AAClB,iBAAOC,KAAK,CAACP,WAAN,EAAP;AACD;;AACD,eAAOC,IAAI,CAACd,WAAL,CAAiBqB,SAAjB,CAA2BN,KAA3B,EAAkCK,KAAK,CAACP,WAAN,EAAlC,EAAuDM,KAAvD,CAAP;AACD,OAPI,EAOF,IAPE,CAAP;AAQD,KATD,MASO;AACL,aAAQ,KAAKf,SAAN,CACJa,OADI,GAEJC,MAFI,CAEoB,CAACC,KAAD,EAAQC,KAAR,KAAkB;AACzC,YAAID,KAAK,KAAK,IAAd,EAAoB;AAClB,iBAAOC,KAAK,CAACP,WAAN,EAAP;AACD;;AACD,eAAOC,IAAI,CAACP,MAAL,CAAYc,SAAZ,CAAsBN,KAAtB,EAA6BK,KAAK,CAACP,WAAN,EAA7B,EAAkDM,KAAlD,CAAP;AACD,OAPI,EAOF,IAPE,CAAP;AAQD;AACF;;AA9DD","sourcesContent":["import type { BlendProps } from \"../../types/ImageFilters\";\nimport type { SkShader, SkImageFilter } from \"../../../skia/types\";\nimport { BlendMode } from \"../../../skia/types\";\nimport { DeclarationType, NodeType } from \"../../types/NodeType\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type { Node } from \"../../types\";\nimport { enumKey } from \"../datatypes\";\n\nimport { ImageFilterDeclaration } from \"./ImageFilters\";\nimport { ShaderDeclaration } from \"./Shaders\";\n\nexport class BlendNode extends JsiDeclarationNode<\n  BlendProps,\n  SkShader | SkImageFilter\n> {\n  constructor(ctx: NodeContext, props: BlendProps) {\n    super(ctx, DeclarationType.ImageFilter, NodeType.Blend, props);\n  }\n\n  private checkChild(\n    child: ImageFilterDeclaration<unknown> | ShaderDeclaration<unknown>\n  ) {\n    if (this._children.length > 0) {\n      if (child.declarationType === DeclarationType.ImageFilter) {\n        this.declarationType = DeclarationType.ImageFilter;\n      } else {\n        this.declarationType = DeclarationType.Shader;\n      }\n    }\n  }\n\n  addChild(child: Node<unknown>) {\n    if (\n      !(child instanceof JsiDeclarationNode) ||\n      (child.declarationType !== DeclarationType.Shader &&\n        child.declarationType !== DeclarationType.ImageFilter)\n    ) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    this.checkChild(child);\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (\n      !(child instanceof ImageFilterDeclaration) ||\n      !(child instanceof ShaderDeclaration)\n    ) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    this.checkChild(child);\n    super.insertChildBefore(child, before);\n  }\n\n  materialize() {\n    const { Skia } = this;\n    const blend = BlendMode[enumKey(this.props.mode)];\n    if (this.declarationType === DeclarationType.ImageFilter) {\n      return (this._children as ImageFilterDeclaration<unknown>[])\n        .reverse()\n        .reduce<SkImageFilter | null>((inner, outer) => {\n          if (inner === null) {\n            return outer.materialize();\n          }\n          return Skia.ImageFilter.MakeBlend(blend, outer.materialize(), inner);\n        }, null) as SkImageFilter;\n    } else {\n      return (this._children as ShaderDeclaration<unknown>[])\n        .reverse()\n        .reduce<SkShader | null>((inner, outer) => {\n          if (inner === null) {\n            return outer.materialize();\n          }\n          return Skia.Shader.MakeBlend(blend, outer.materialize(), inner);\n        }, null) as SkShader;\n    }\n  }\n}\n"]}