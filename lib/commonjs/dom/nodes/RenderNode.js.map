{"version":3,"sources":["RenderNode.ts"],"names":["paintProps","JsiRenderNode","JsiNode","constructor","ctx","type","props","matrix","Skia","Matrix","onPropChange","setProps","paintCache","setProp","key","value","hasChanged","includes","identity","clipPath","undefined","clipRect","clipRRect","computeMatrix","computeClip","addChild","child","JsiDeclarationNode","setInvalidate","insertChildBefore","before","clip","getPaintCtx","color","strokeWidth","blendMode","style","strokeJoin","strokeCap","strokeMiter","opacity","antiAlias","Color","BlendMode","PaintStyle","StrokeJoin","StrokeCap","_children","forEach","isColorFilter","cf","materialize","colorFilter","ColorFilter","MakeCompose","isShader","shader","isPathEffect","pe","pathEffect","PathEffect","isImageFilter","filter","imageFilter","ImageFilter","isMaskFilter","maskFilter","render","parentCtx","invertClip","layer","transform","canvas","parent","paint","paintCtx","concatPaint","hasTransform","hasClip","shouldSave","op","ClipOp","Difference","Intersect","saveLayer","isSkPaint","current","save","concat","renderNode","restore","obj","__typename__","alpha","copy","setShader","setColor","cl","getColor","setStrokeWidth","setAntiAlias","setBlendMode","setColorFilter","setImageFilter","setMaskFilter","setPathEffect","setAlphaf","setStrokeCap","setStrokeJoin","setStrokeMiter","setStyle"],"mappings":"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","sourcesContent":["import type { RefObject } from \"react\";\n\nimport type {\n  SkMatrix,\n  SkRect,\n  SkRRect,\n  SkPath,\n  SkPaint,\n} from \"../../skia/types\";\nimport {\n  StrokeCap,\n  StrokeJoin,\n  PaintStyle,\n  BlendMode,\n  ClipOp,\n  isRRect,\n} from \"../../skia/types\";\nimport type {\n  RenderNode,\n  GroupProps,\n  DrawingContext,\n  NodeType,\n  Node,\n  DeclarationNode,\n} from \"../types\";\n\nimport { isPathDef, processPath, processTransformProps } from \"./datatypes\";\nimport type { NodeContext } from \"./Node\";\nimport { JsiNode, JsiDeclarationNode } from \"./Node\";\nimport type { PaintContext } from \"./PaintContext\";\nimport { enumKey } from \"./datatypes/Enum\";\n\nconst paintProps = [\n  \"color\",\n  \"strokeWidth\",\n  \"blendMode\",\n  \"strokeCap\",\n  \"strokeJoin\",\n  \"strokeMiter\",\n  \"style\",\n  \"antiAlias\",\n  \"opacity\",\n];\n\ninterface PaintCache {\n  parent: SkPaint;\n  child: SkPaint;\n}\n\nexport abstract class JsiRenderNode<P extends GroupProps>\n  extends JsiNode<P>\n  implements RenderNode<P>\n{\n  paintCache: PaintCache | null = null;\n  matrix: SkMatrix;\n  clipRect?: SkRect;\n  clipRRect?: SkRRect;\n  clipPath?: SkPath;\n\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, type, props);\n    this.matrix = this.Skia.Matrix();\n    this.onPropChange();\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.onPropChange();\n    this.paintCache = null;\n  }\n\n  setProp<K extends keyof P>(key: K, value: P[K]) {\n    const hasChanged = super.setProp(key, value);\n    if (hasChanged) {\n      this.onPropChange();\n      if (paintProps.includes(key as string)) {\n        this.paintCache = null;\n      }\n    }\n    return hasChanged;\n  }\n\n  protected onPropChange() {\n    this.matrix.identity();\n    this.clipPath = undefined;\n    this.clipRect = undefined;\n    this.clipRRect = undefined;\n    this.computeMatrix();\n    this.computeClip();\n  }\n\n  addChild(child: Node<unknown>) {\n    if (child instanceof JsiDeclarationNode) {\n      child.setInvalidate(() => (this.paintCache = null));\n    }\n    super.addChild(child);\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>) {\n    if (child instanceof JsiDeclarationNode) {\n      child.setInvalidate(() => (this.paintCache = null));\n    }\n    super.insertChildBefore(child, before);\n  }\n\n  private computeClip() {\n    const { clip } = this.props;\n    if (clip) {\n      if (isPathDef(clip)) {\n        this.clipPath = processPath(this.Skia, clip);\n      } else if (isRRect(clip)) {\n        this.clipRRect = clip;\n      } else {\n        this.clipRect = clip;\n      }\n    }\n  }\n\n  private computeMatrix() {\n    processTransformProps(this.matrix, this.props);\n  }\n\n  private getPaintCtx() {\n    let ctx: PaintContext | undefined;\n    const {\n      color,\n      strokeWidth,\n      blendMode,\n      style,\n      strokeJoin,\n      strokeCap,\n      strokeMiter,\n      opacity,\n      antiAlias,\n    } = this.props;\n    if (\n      color !== undefined ||\n      strokeWidth !== undefined ||\n      blendMode !== undefined ||\n      style !== undefined ||\n      strokeJoin !== undefined ||\n      strokeCap !== undefined ||\n      strokeMiter !== undefined ||\n      opacity !== undefined ||\n      antiAlias !== undefined\n    ) {\n      ctx = {};\n      if (color !== undefined) {\n        ctx.color = this.Skia.Color(color);\n      }\n      if (strokeWidth !== undefined) {\n        ctx.strokeWidth = strokeWidth;\n      }\n      if (blendMode !== undefined) {\n        ctx.blendMode = BlendMode[enumKey(blendMode)];\n      }\n      if (style !== undefined) {\n        ctx.style = PaintStyle[enumKey(style)];\n      }\n      if (strokeJoin !== undefined) {\n        ctx.strokeJoin = StrokeJoin[enumKey(strokeJoin)];\n      }\n      if (strokeCap !== undefined) {\n        ctx.strokeCap = StrokeCap[enumKey(strokeCap)];\n      }\n      if (strokeMiter !== undefined) {\n        ctx.strokeMiter = strokeMiter;\n      }\n      if (opacity !== undefined) {\n        ctx.opacity = opacity;\n      }\n      if (antiAlias !== undefined) {\n        ctx.antiAlias = antiAlias;\n      }\n    }\n    this._children.forEach((child) => {\n      if (child instanceof JsiDeclarationNode) {\n        if (child.isColorFilter()) {\n          ctx = ctx || {};\n          const cf = child.materialize();\n          ctx.colorFilter = ctx.colorFilter\n            ? this.Skia.ColorFilter.MakeCompose(cf, ctx.colorFilter)\n            : cf;\n        } else if (child.isShader()) {\n          ctx = ctx || {};\n          const shader = child.materialize();\n          ctx.shader = shader;\n        } else if (child.isPathEffect()) {\n          ctx = ctx || {};\n          const pe = child.materialize();\n          ctx.pathEffect = ctx.pathEffect\n            ? this.Skia.PathEffect.MakeCompose(pe, ctx.pathEffect)\n            : pe;\n        } else if (child.isImageFilter()) {\n          ctx = ctx || {};\n          const filter = child.materialize();\n          ctx.imageFilter = ctx.imageFilter\n            ? this.Skia.ImageFilter.MakeCompose(filter, ctx.imageFilter)\n            : filter;\n        } else if (child.isMaskFilter()) {\n          ctx = ctx || {};\n          const filter = child.materialize();\n          ctx.maskFilter = filter;\n        }\n      }\n    });\n    return ctx;\n  }\n\n  render(parentCtx: DrawingContext) {\n    const { invertClip, layer, matrix, transform } = this.props;\n    const { canvas } = parentCtx;\n\n    const opacity = this.props.opacity\n      ? parentCtx.opacity * this.props.opacity\n      : parentCtx.opacity;\n\n    if (\n      this.paintCache === null ||\n      this.paintCache.parent !== parentCtx.paint\n    ) {\n      const paintCtx = this.getPaintCtx();\n      const child = paintCtx\n        ? concatPaint(parentCtx.paint, paintCtx, parentCtx.opacity)\n        : parentCtx.paint;\n      this.paintCache = { parent: parentCtx.paint, child };\n    }\n    const paint = this.paintCache.child;\n    // TODO: can we only recreate a new context here if needed?\n    const ctx = { ...parentCtx, opacity, paint };\n    const hasTransform = matrix !== undefined || transform !== undefined;\n    const hasClip = this.clipRect !== undefined;\n    const shouldSave = hasTransform || hasClip || !!layer;\n    const op = invertClip ? ClipOp.Difference : ClipOp.Intersect;\n\n    if (shouldSave) {\n      if (layer) {\n        if (typeof layer === \"boolean\") {\n          canvas.saveLayer();\n        } else if (isSkPaint(layer)) {\n          canvas.saveLayer(layer);\n        } else {\n          canvas.saveLayer(\n            layer.current ? layer.current.materialize() : undefined\n          );\n        }\n      } else {\n        canvas.save();\n      }\n    }\n\n    if (this.matrix) {\n      canvas.concat(this.matrix);\n    }\n    if (this.clipRect) {\n      canvas.clipRect(this.clipRect, op, true);\n    }\n    if (this.clipRRect) {\n      canvas.clipRRect(this.clipRRect, op, true);\n    }\n    if (this.clipPath) {\n      canvas.clipPath(this.clipPath, op, true);\n    }\n\n    this.renderNode(ctx);\n\n    if (shouldSave) {\n      canvas.restore();\n    }\n  }\n\n  abstract renderNode(ctx: DrawingContext): void;\n}\n\nexport const isSkPaint = (\n  obj: RefObject<DeclarationNode<unknown, SkPaint>> | SkPaint\n): obj is SkPaint => \"__typename__\" in obj && obj.__typename__ === \"Paint\";\n\nconst concatPaint = (\n  parent: SkPaint,\n  {\n    color,\n    strokeWidth,\n    shader,\n    antiAlias,\n    blendMode,\n    colorFilter,\n    imageFilter,\n    maskFilter,\n    pathEffect,\n    opacity: alpha,\n    strokeCap,\n    strokeJoin,\n    strokeMiter,\n    style,\n  }: PaintContext,\n  opacity: number\n) => {\n  const paint = parent.copy();\n  if (color !== undefined) {\n    paint.setShader(null);\n    color[3] *= opacity;\n    paint.setColor(color);\n  } else {\n    const cl = paint.getColor();\n    cl[3] *= opacity;\n    paint.setColor(cl);\n  }\n  if (strokeWidth !== undefined) {\n    paint.setStrokeWidth(strokeWidth);\n  }\n  if (shader !== undefined) {\n    paint.setShader(shader);\n  }\n  if (antiAlias !== undefined) {\n    paint.setAntiAlias(antiAlias);\n  }\n  if (blendMode !== undefined) {\n    paint.setBlendMode(blendMode);\n  }\n  if (colorFilter !== undefined) {\n    paint.setColorFilter(colorFilter);\n  }\n  if (imageFilter !== undefined) {\n    paint.setImageFilter(imageFilter);\n  }\n  if (maskFilter !== undefined) {\n    paint.setMaskFilter(maskFilter);\n  }\n  if (pathEffect !== undefined) {\n    paint.setPathEffect(pathEffect);\n  }\n  if (alpha !== undefined) {\n    paint.setAlphaf(alpha * opacity);\n  }\n  if (strokeCap !== undefined) {\n    paint.setStrokeCap(strokeCap);\n  }\n  if (strokeJoin !== undefined) {\n    paint.setStrokeJoin(strokeJoin);\n  }\n  if (strokeMiter !== undefined) {\n    paint.setStrokeMiter(strokeMiter);\n  }\n  if (style !== undefined) {\n    paint.setStyle(style);\n  }\n  return paint;\n};\n"]}