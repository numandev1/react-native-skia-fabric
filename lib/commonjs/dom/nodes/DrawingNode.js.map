{"version":3,"sources":["DrawingNode.ts"],"names":["JsiDrawingNode","JsiRenderNode","constructor","ctx","type","props","derived","deriveProps","setProps","setProp","name","value","hasChanged","addChild","child","JsiDeclarationNode","Error","insertChildBefore","before","renderNode","paint","draw","current","materialize","children","map","PaintNode"],"mappings":";;;;;;;AASA;;AACA;;AACA;;;;AAEO,MAAeA,cAAf,SACGC,yBADH,CAGP;AAGEC,EAAAA,WAAW,CAACC,GAAD,EAAmBC,IAAnB,EAAmCC,KAAnC,EAA6C;AACtD,UAAMF,GAAN,EAAWC,IAAX,EAAiBC,KAAjB;;AADsD;;AAEtD,SAAKC,OAAL,GAAe,KAAKC,WAAL,EAAf;AACD;;AAEDC,EAAAA,QAAQ,CAACH,KAAD,EAAW;AACjB,UAAMG,QAAN,CAAeH,KAAf;AACA,SAAKC,OAAL,GAAe,KAAKC,WAAL,EAAf;AACD;;AAEDE,EAAAA,OAAO,CAAoBC,IAApB,EAA6BC,KAA7B,EAA0C;AAC/C,UAAMC,UAAU,GAAG,MAAMH,OAAN,CAAcC,IAAd,EAAoBC,KAApB,CAAnB;;AACA,QAAIC,UAAJ,EAAgB;AACd,WAAKN,OAAL,GAAe,KAAKC,WAAL,EAAf;AACD;;AACD,WAAOK,UAAP;AACD;;AAEDC,EAAAA,QAAQ,CAACC,KAAD,EAA6B;AACnC,QAAI,EAAEA,KAAK,YAAYC,wBAAnB,CAAJ,EAA4C;AAC1C,YAAM,IAAIC,KAAJ,CAAW,cAAaF,KAAK,CAACV,IAAK,OAAM,KAAKA,IAAK,EAAnD,CAAN;AACD;;AACD,UAAMS,QAAN,CAAeC,KAAf;AACA,SAAKR,OAAL,GAAe,KAAKC,WAAL,EAAf;AACD;;AAEDU,EAAAA,iBAAiB,CAACH,KAAD,EAAuBI,MAAvB,EAAoD;AACnE,QAAI,EAAEJ,KAAK,YAAYC,wBAAnB,CAAJ,EAA4C;AAC1C,YAAM,IAAIC,KAAJ,CAAW,cAAaF,KAAK,CAACV,IAAK,OAAM,KAAKA,IAAK,EAAnD,CAAN;AACD;;AACD,UAAMa,iBAAN,CAAwBH,KAAxB,EAA+BI,MAA/B;AACA,SAAKZ,OAAL,GAAe,KAAKC,WAAL,EAAf;AACD;;AAEDY,EAAAA,UAAU,CAAChB,GAAD,EAA4B;AACpC,QAAI,KAAKE,KAAL,CAAWe,KAAX,IAAoB,2BAAU,KAAKf,KAAL,CAAWe,KAArB,CAAxB,EAAqD;AACnD,WAAKC,IAAL,CAAU,EAAE,GAAGlB,GAAL;AAAUiB,QAAAA,KAAK,EAAE,KAAKf,KAAL,CAAWe;AAA5B,OAAV;AACD,KAFD,MAEO,IAAI,KAAKf,KAAL,CAAWe,KAAX,IAAoB,KAAKf,KAAL,CAAWe,KAAX,CAAiBE,OAAjB,IAA4B,IAApD,EAA0D;AAC/D,WAAKD,IAAL,CAAU,EAAE,GAAGlB,GAAL;AAAUiB,QAAAA,KAAK,EAAE,KAAKf,KAAL,CAAWe,KAAX,CAAiBE,OAAjB,CAAyBC,WAAzB;AAAjB,OAAV;AACD,KAFM,MAEA;AACL,WAAKF,IAAL,CAAUlB,GAAV;AACD;;AACD,SAAKqB,QAAL,GAAgBC,GAAhB,CAAqBX,KAAD,IAAW;AAC7B,UAAIA,KAAK,YAAYY,oBAArB,EAAgC;AAC9B,cAAMN,KAAK,GAAGN,KAAK,CAACS,WAAN,EAAd;AACA,aAAKF,IAAL,CAAU,EAAE,GAAGlB,GAAL;AAAUiB,UAAAA;AAAV,SAAV;AACD;AACF,KALD;AAMD;;AAnDH","sourcesContent":["import type {\n  DrawingContext,\n  DrawingNodeProps,\n  Node,\n  NodeType,\n  RenderNode,\n} from \"../types\";\n\nimport type { NodeContext } from \"./Node\";\nimport { JsiDeclarationNode } from \"./Node\";\nimport { PaintNode } from \"./PaintNode\";\nimport { isSkPaint, JsiRenderNode } from \"./RenderNode\";\n\nexport abstract class JsiDrawingNode<P extends DrawingNodeProps, C>\n  extends JsiRenderNode<P>\n  implements RenderNode<P>\n{\n  protected derived?: C;\n\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, type, props);\n    this.derived = this.deriveProps();\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.derived = this.deriveProps();\n  }\n\n  setProp<K extends keyof P>(name: K, value: P[K]) {\n    const hasChanged = super.setProp(name, value);\n    if (hasChanged) {\n      this.derived = this.deriveProps();\n    }\n    return hasChanged;\n  }\n\n  addChild(child: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n    this.derived = this.deriveProps();\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n    this.derived = this.deriveProps();\n  }\n\n  renderNode(ctx: DrawingContext): void {\n    if (this.props.paint && isSkPaint(this.props.paint)) {\n      this.draw({ ...ctx, paint: this.props.paint });\n    } else if (this.props.paint && this.props.paint.current != null) {\n      this.draw({ ...ctx, paint: this.props.paint.current.materialize() });\n    } else {\n      this.draw(ctx);\n    }\n    this.children().map((child) => {\n      if (child instanceof PaintNode) {\n        const paint = child.materialize();\n        this.draw({ ...ctx, paint });\n      }\n    });\n  }\n\n  protected abstract draw(ctx: DrawingContext): void;\n  protected abstract deriveProps(): C;\n}\n"]}